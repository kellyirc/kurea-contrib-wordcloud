<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>wordcloud</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
        .navbar { margin-bottom: 0; }
    </style>
</head>
<body>
<nav class="navbar navbar-default navbar-static-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand">Kurea Wordcloud</a>
        </div>
        <ul class="nav navbar-nav">
            <li><a href><span id="data-dump"></span></a></li>
        </ul>
    </div>
</nav>
<div id="vis"></div>
<script src="https://cdn.rawgit.com/timdream/wordcloud2.js/v1.0.1/src/wordcloud2.js"></script>
<script src="https://cdn.rawgit.com/organic-scholar/http.js/0.1/http.min.js"></script>
<script>
    var parts = location.href.split('?')[1].split('&');
    var channel = '';
    var server = '';

    var width = window.innerWidth - 10;
    var height = window.innerHeight - 60; //bootstrap header

    // gotta love hashes in the url just doing hash things
    parts.forEach(function(part) {
        if(part.indexOf('channel') !== -1) { channel = part.split('=')[1]; }
        if(part.indexOf('server') !== -1) { server = part.split('=')[1]; }
    });

    var request = new Http.Post('./data', {server: server, channel: channel})
        .start()
        .then(function(response) {
            var words = JSON.parse(response).words;
            var total = words.reduce(function(prev, cur) { return prev + cur.value; }, 0);
            document.getElementById('data-dump').innerText = words.length + ' total words, ' + total + ' instances counted for '+server+channel;
            var list = [];
            words.forEach(function(word) {
                list.push([word._id, word.value]);
            });

            var node = document.getElementById('vis');
            node.style.height = height+'px';
            node.style.width = width+'px';
            WordCloud(node, { list: list, weightFactor: 7, shape: 'circle', ellipicity: 0.9, rotateRatio: 0.5 });
        });
</script>
</body>
</html>